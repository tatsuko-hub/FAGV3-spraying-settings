<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ドローン散布 吐出スピード計算（テスト版）</title>
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root { --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --accent:#0ea5e9; --ring: rgba(14,165,233,.45); --error:#fca5a5; --highlight:#10213a; --outputbg:#14233f; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,sans-serif;background:linear-gradient(180deg,#0b1220,#0b1220 40%,#0e1b2e);color:var(--text);display:grid;place-items:center;padding:24px}
    .app{width:min(820px,100%)}
    .title{font-size:22px;font-weight:700;letter-spacing:.2px;margin:0 0 14px;display:flex;align-items:center;gap:10px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
    .row{display:grid;grid-template-columns:1fr;gap:16px;padding:18px}
    .field{display:grid;gap:8px;padding:8px 10px;border-radius:12px;background:var(--highlight)}
    .field.dose-field{background:rgba(14,165,233,0.08);border:1px solid rgba(14,165,233,0.25)}
    .out{padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:var(--outputbg)}
    .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    label{font-size:13px;color:var(--muted)}
    input[type="number"],select{width:100%;font-size:18px;padding:12px 12px;border-radius:12px;background:#0b1220;border:1px solid rgba(255,255,255,.08);color:var(--text);outline:none;transition:border .15s, box-shadow .15s}
    input[type="number"]:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
    .seg{display:inline-flex;border:1px solid rgba(255,255,255,.1);border-radius:10px;overflow:hidden}
    .seg button{background:#0b1220;color:var(--text);border:0;padding:10px 14px;font-size:14px;cursor:pointer}
    .seg button.active{background:rgba(14,165,233,.15)}
    .muted{color:var(--muted);font-size:12px}
    .sub{padding:0 18px 18px;display:grid;gap:10px}
    .outbox{display:grid;gap:12px;grid-template-columns:1fr 1fr}
    .out .val{font-size:24px;font-weight:700}
    .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .kpi .cardmini{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0b1220;text-align:center}
    .kpi .cardmini .big{font-size:18px;font-weight:700}
    .error{color:var(--error)}
    .testbar{display:flex;gap:10px;align-items:center;justify-content:flex-end}
    .btn{padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:#0b1220;color:var(--text);font-size:12px;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    @media (max-width:560px){.grid{grid-template-columns:1fr}.outbox{grid-template-columns:1fr}.kpi{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="app" role="application">
    <h1 class="title">ドローン散布 吐出スピード計算 <span class="muted">（テスト版・Web）</span></h1>

    <section class="card" aria-label="converter">
      <div class="row">
        <!-- 剤型切替 -->
        <div class="field">
          <label>剤型の選択</label>
          <div class="seg" id="formToggle" role="tablist" aria-label="剤型">
            <button type="button" class="active" data-mode="granular" aria-selected="true">粒剤（kg）</button>
            <button type="button" data-mode="liquid" aria-selected="false">液剤（mL）</button>
          </div>
        </div>

        <!-- 入力タイプ/単位 -->
        <div class="grid">
          <div class="field">
            <label>入力タイプ</label>
            <select id="inputType" aria-label="入力タイプ">
              <option value="area">面積あたり（推奨）</option>
              <option value="time">時間あたり</option>
            </select>
          </div>
          <div class="field">
            <label>単位</label>
            <select id="unit" aria-label="単位"></select>
          </div>
        </div>
        <!-- 施用量入力 -->
        <div class="field dose-field">
          <label id="doseLabel">施用量</label>
          <input id="dose" type="number" inputmode="decimal" step="any" placeholder="数値を入力" autocomplete="off" />
          <div class="muted">条件は下の <b>速度・散布幅</b> を変更して調整できます</div>
          <div class="muted error" id="error" style="display:none"></div>
        </div>

        <!-- 速度（縦配置） -->
        <div class="field">
          <label>速度（m/s）<span class="muted">　※20 km/h超はエラー</span></label>
          <input id="speed" type="number" inputmode="decimal" step="any" placeholder="例: 4.2" value="4.2" autocomplete="off" />
          <div class="muted">現在: <span id="speedKmh">—</span> km/h</div>
        </div>

        <!-- 散布幅（縦配置） -->
        <div class="field">
          <label>散布幅（m）</label>
          <input id="width" type="number" inputmode="decimal" step="any" placeholder="例: 4" value="4" autocomplete="off" />
        </div>

        <!-- 出力/指標 -->
        <div class="sub">
          <div class="outbox">
            <div class="out" style="background:var(--outputbg);border:1px solid rgba(14,165,233,0.35)">
              <div class="muted">吐出スピード</div>
              <div class="val" id="flow">—</div>
              <div class="muted" id="flowUnit"></div>
            </div>
            <div class="out">
              <div class="muted">参考：1反あたりの散布時間</div>
              <div class="val" id="timePerTan">—</div>
              <div class="muted">理論値（速度・幅から算出）</div>
            </div>
          </div>
          <div class="kpi">
            <div class="cardmini">
              <div class="muted">面積処理能力</div>
              <div class="big" id="areaRate">—</div>
              <div class="muted">（反/分・ha/分）</div>
            </div>
            <div class="cardmini">
              <div class="muted">式</div>
              <div class="big">流量 = 施用量 × 面積処理能力</div>
              <div class="muted">（面積入力時）</div>
            </div>
            <div class="cardmini">
              <div class="muted">メモ</div>
              <div>初期値4.2m/s・幅4mでは <b>約1.008反/分</b>（≒0.1008ha/分）。</div>
            </div>
          </div>
          <div class="testbar">
            <button class="btn" id="runTests" title="簡易テストを実行">開発者テストを実行</button>
            <span class="muted" id="testResult"></span>
          </div>
        </div>
      </div>
    </section>

    <p class="muted" style="margin-top:10px">単位換算：1反 = 1000 m²、1 ha = 10000 m²、1 L = 1000 mL</p>
  </main>
</body>
</html>
